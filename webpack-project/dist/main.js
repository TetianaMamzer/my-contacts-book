(()=>{"use strict";var e={d:(t,s)=>{for(var a in s)e.o(s,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:s[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{l:()=>r});class t{static getStoragUsers(){const e=localStorage.getItem("users");return e&&0!=JSON.parse(e).length?JSON.parse(e):null}static setStoragUsers(e){localStorage.setItem("users",JSON.stringify(e))}}class s{constructor(){this._users=[]}get users(){return this._users}async getUsers(){const e=t.getStoragUsers();if(e)this._users=e;else{let e=await fetch("https://jsonplaceholder.typicode.com/users");if(e.ok){let s=(await e.json()).map((e=>({id:e.id,name:e.name,email:e.email,code:e.address.zipcode.slice(-4)})));this._users.push(...s),t.setStoragUsers(this._users)}else console.log("HTTP-Error: "+e.status)}}filterUsers(e){return this._users.filter((t=>t.name.toLowerCase().includes(e.toLowerCase())))}sortUsers(e){let t;t="number"==typeof this._users[0][e]?(t,s)=>t[e]-s[e]:(t,s)=>t[e].localeCompare(s[e]),this._users.sort(t)}updateUser(e){const s=this._users.findIndex((t=>t.id==e.id));this._users[s].name=e.name,this._users[s].email=e.email,this._users[s].code=e.code,t.setStoragUsers(this._users)}addUser(e){e.id=Math.max(...this._users.map((e=>e.id)))+1,this._users.push(e),t.setStoragUsers(this._users)}deleteUser(e){const s=this._users.findIndex((t=>t.id==e));this._users.splice(s,1),t.setStoragUsers(this._users)}getUserById(e){return this._users.find((t=>t.id==e))}}class a{constructor(){this._filterInput=document.querySelector('[type="search"]'),this._loadEventListenrs()}_loadEventListenrs(){this._filterInput.addEventListener("input",function(e,t=300){let s;return(...a)=>{clearTimeout(s),s=setTimeout((()=>{e.apply(this,a)}),t)}}((()=>this._filterUsersHandler())))}_filterUsersHandler(){let e=r.users.filterUsers(this._filterInput.value);r.table.createTable(e)}}class i{constructor(){this._tablet=document.querySelector(".table-body"),this._thead=document.querySelector("thead"),this._loadEventListenrs()}_loadEventListenrs(){this._thead.addEventListener("click",this.sortUsersHandler.bind(this))}createTable(e=r.users.users){this.resetTable();for(const t of e)this.createRow(t)}createRow(e){const t=document.createElement("tr");t.dataset.id=e.id;const s=document.createElement("th");s.setAttribute("scope","row"),s.innerText=e.id,t.append(s);const a=document.createElement("td");a.innerText=e.name,t.append(a);const i=document.createElement("td");i.innerText=e.email,t.append(i);const d=document.createElement("td");d.innerHTML=e.code,t.append(d);const l=document.createElement("td"),r=document.createElement("button");r.dataset.id=e.id,r.setAttribute("type","button"),r.classList.add("btn","btn-dark","btn-sm","me-2"),r.innerText="Edit",r.addEventListener("click",this.editUser),l.append(r);const n=document.createElement("button");n.dataset.id=e.id,n.setAttribute("type","button"),n.classList.add("btn","btn-danger","btn-sm"),n.innerText="Delete",n.addEventListener("click",this.deleteUserHandler.bind(this)),l.append(n),t.append(l),this._tablet.append(t)}editUser(e){const t=r.users.getUserById(e.target.dataset.id);document.querySelector(`.table-body > [data-id='${e.target.dataset.id}']`).classList.add("row_edit"),r.form.fillForm(t)}deleteUserHandler(e){r.users.deleteUser(e.target.dataset.id),document.querySelector(`.table-body > [data-id='${e.target.dataset.id}']`).classList.add("delete"),setTimeout((()=>{console.log(this),this.createTable()}),500)}resetTable(){this._tablet.innerHTML=""}sortUsersHandler(e){const t=e.target.dataset.sort;r.users.sortUsers(t),this.createTable()}}const d=new class{validateName(e){let t,s;return e.trim().length>0&&/^[ \a-zA-Z0-9_\.-]{3,30}$/.test(e.trim())?(t=!0,s="Looks good!"):(t=!1,s="Please enter name. The name must contain more than 3 characters."),{result:t,message:s}}validateEmail(e){let t,s;return/^([a-zA-Z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/.test(e.trim())?(t=!0,s="Looks good!"):(t=!1,s="Please enter email. For example: example@gmail.com"),{result:t,message:s}}validateCode(e){let t,s;return/^([0-9]{4})$/.test(e.trim())?(t=!0,s="Looks good!"):(t=!1,s="Please enter code. The code must contain 4 numbers"),{result:t,message:s}}};class l{constructor(){this.nameIsValid=document.querySelector(".name-valid"),this.emailIsValid=document.querySelector(".email-valid"),this.codeIsValid=document.querySelector(".code-valid"),this.form=document.forms.addUser,this.name=this.form.elements.name,this.email=this.form.elements.email,this.code=this.form.elements.code,this._loadEventListeners()}_loadEventListeners(){this.code.addEventListener("blur",this._codeBlurHandler.bind(this)),this.code.addEventListener("focus",this._codeFocusHandler.bind(this)),this.email.addEventListener("blur",this._emailBlurHandler.bind(this)),this.email.addEventListener("focus",this._emailFocusHandler.bind(this)),this.name.addEventListener("blur",this._nameBlurHandler.bind(this)),this.name.addEventListener("focus",this._nameFocusHandler.bind(this)),this.form.addEventListener("submit",this._formOnHandler.bind(this))}_codeBlurHandler(){const e=d.validateCode(this.code.value);e.result?(this.code.classList.add("is-valid"),this.codeIsValid.classList.add("valid-feedback")):(this.code.classList.add("is-invalid"),this.codeIsValid.classList.add("invalid-feedback")),this.codeIsValid.innerText=e.message}_codeFocusHandler(){this.code.classList.remove("is-valid","is-invalid"),this.codeIsValid.classList.remove("valid-feedback","invalid-feedback")}_emailBlurHandler(){const e=d.validateEmail(this.email.value);e.result?(this.email.classList.add("is-valid"),this.emailIsValid.classList.add("valid-feedback")):(this.email.classList.add("is-invalid"),this.emailIsValid.classList.add("invalid-feedback")),this.emailIsValid.innerText=e.message}_emailFocusHandler(){this.email.classList.remove("is-valid","is-invalid"),this.emailIsValid.classList.remove("valid-feedback","invalid-feedback")}_nameBlurHandler(){const e=d.validateName(this.name.value);1==e.result?(this.name.classList.add("is-valid"),this.nameIsValid.classList.add("valid-feedback")):(this.name.classList.add("is-invalid"),this.nameIsValid.classList.add("invalid-feedback")),this.nameIsValid.innerText=e.message}_nameFocusHandler(){console.log(this),this.name.classList.remove("is-valid","is-invalid"),this.nameIsValid.classList.remove("valid-feedback","invalid-feedback")}_formOnHandler(e){e.preventDefault(),e.stopPropagation();const t=d.validateName(this.name.value),s=d.validateCode(this.code.value),a=d.validateEmail(this.email.value),i=document.querySelector(".modal-body");t.result&&s.result&&a.result?(this.formHandle(e),this.code.classList.remove("is-valid","is-invalid"),this.codeIsValid.classList.remove("valid-feedback","invalid-feedback"),this.name.classList.remove("is-valid","is-invalid"),this.nameIsValid.classList.remove("valid-feedback","invalid-feedback"),this.email.classList.remove("is-valid","is-invalid"),this.emailIsValid.classList.remove("valid-feedback","invalid-feedback"),i.innerText="Perfectly! New contact added"):i.innerText="Oops! Fill in all fields correctly!"}formHandle(e){e.preventDefault(),this.form.hasAttribute("data-id")?(r.users.updateUser({id:this.form.getAttribute("data-id"),name:this.form.elements.name.value,email:this.form.elements.email.value,code:this.form.elements.code.value}),this.form.removeAttribute("data-id")):r.users.addUser({name:this.form.elements.name.value,email:this.form.elements.email.value,code:this.form.elements.code.value}),this.form.reset(),r.table.createTable()}fillForm(e){this.form.elements.name.value=e.name,this.form.elements.email.value=e.email,this.form.elements.code.value=e.code,this.form.setAttribute("data-id",e.id)}}const r=new class{constructor(){this.users=new s,this.filter=new a,this.table=new i,this.form=new l,this._init()}async _init(){await this.users.getUsers(),this.table.createTable()}}})();